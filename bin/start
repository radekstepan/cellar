#!/usr/bin/env bash
# Start the Docker container

# Go to the root of the project
cd "$(dirname "$0")/.."

output=$(docker-compose up -d --remove-orphans 2>&1)
if [ $? -ne 0 ]; then
  echo "Failed to start."
  echo ""
  echo "Details:"
  echo "$output"
  echo ""
  echo "Suggestion: Ensure Docker is running. Alternatively, run locally without Docker using 'yarn dev'."
  exit 1
fi

for i in {1..7}; do
  if curl -s http://localhost:3001/api/schema >/dev/null; then
    echo "Started."
    exit 0
  fi
  sleep 1
done

echo "Failed to start."
echo ""
echo "Details: The server did not respond at http://localhost:3001 within 7 seconds."
echo ""
echo "Suggestion: Check if port 3001 is already in use by another application, or view 'docker-compose logs' for more details."
exit 1
